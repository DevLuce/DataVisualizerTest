{
  "database_info": {
    "name": "FODI Dance Database",
    "description": "댄스 동선표 및 사용자 관리 시스템을 위한 Firestore 데이터베이스",
    "version": "2.0",
    "last_updated": "2025-01-01"
  },
  "collections": {
    "User_V2": {
      "description": "앱 사용자 프로필/동의 상태와 가입·활성 시각을 보관하는 기준 컬렉션",
      "document_structure": {
        "documentId": {
          "type": "string",
          "description": "Firestore 문서 ID (=userId). 조인/출력 시 userId 사용",
          "example": "user_12345",
          "required": true
        },
        "createdAt": {
          "type": "timestamp",
          "description": "가입 시각(Asia/Seoul 권장)",
          "example": "2025-01-01T10:30:00Z",
          "required": true
        },
        "lastActiveAt": {
          "type": "timestamp",
          "description": "마지막 접속 시각",
          "example": "2025-01-01T14:20:00Z",
          "required": false
        },
        "provider": {
          "type": "string",
          "description": "인증 공급자",
          "example": "APPLE",
          "options": ["APPLE", "GOOGLE", "KAKAO"],
          "required": true
        },
        "email": {
          "type": "string",
          "description": "이메일(PII, 기본 비노출)",
          "example": "user@example.com",
          "required": false
        },
        "nickname": {
          "type": "string",
          "description": "닉네임",
          "example": "댄서123",
          "required": false
        },
        "gender": {
          "type": "string",
          "description": "성별 코드",
          "example": "M",
          "options": ["M", "F", "O"],
          "required": false
        },
        "eventNotificationAgree": {
          "type": "boolean",
          "description": "이벤트 알림 동의",
          "example": true,
          "required": false
        },
        "pushNotificationAgree": {
          "type": "boolean",
          "description": "푸시 동의",
          "example": true,
          "required": false
        },
        "shareNotificationAgree": {
          "type": "boolean",
          "description": "공유 알림 동의",
          "example": false,
          "required": false
        },
        "marketingAgree": {
          "type": "boolean",
          "description": "마케팅 동의",
          "example": true,
          "required": false
        },
        "privacyAgree": {
          "type": "boolean",
          "description": "개인정보 동의",
          "example": true,
          "required": true
        },
        "termsAgree": {
          "type": "boolean",
          "description": "약관 동의",
          "example": true,
          "required": true
        },
        "teams": {
          "type": "array",
          "description": "소속 팀(중첩)",
          "example": [{"teamId": "team_001", "role": "member"}],
          "required": false
        }
      },
      "indexes": ["createdAt", "lastActiveAt", "provider", "gender"],
      "common_queries": [
        "신규 가입자 수 (일/주/월)",
        "활성 사용자 수",
        "인증 공급자별 사용자 분포",
        "성별 사용자 분포",
        "동의 상태별 사용자 수"
      ]
    },
    "PREMIUM_PERFORMANCE_V2": {
      "description": "스토어에서 판매 중인 프리미엄 동선표의 메타데이터와 상태를 담는 컬렉션",
      "document_structure": {
        "documentId": {
          "type": "string",
          "description": "Firestore 문서 ID (=premiumPerformanceId). 출력 시 별칭 사용",
          "example": "pp_001",
          "required": true
        },
        "title": {
          "type": "string",
          "description": "노래 제목",
          "example": "Dynamite",
          "required": true
        },
        "artist": {
          "type": "string",
          "description": "아티스트",
          "example": "BTS",
          "required": true
        },
        "headCount": {
          "type": "number",
          "description": "인원수",
          "example": 7,
          "required": true
        },
        "isOfficial": {
          "type": "boolean",
          "description": "공식 동선 여부",
          "example": true,
          "required": true
        },
        "isCompleted": {
          "type": "boolean",
          "description": "제작 완료 여부",
          "example": true,
          "required": true
        },
        "isBoyGroup": {
          "type": "boolean",
          "description": "보이그룹 여부",
          "example": true,
          "required": true
        },
        "price": {
          "type": "number",
          "description": "판매가",
          "example": 15000,
          "required": true
        },
        "musicId": {
          "type": "number",
          "description": "내부 곡 ID",
          "example": 1001,
          "required": true
        },
        "members": {
          "type": "array",
          "description": "멤버 배열",
          "example": [{"name": "RM", "position": "center"}],
          "required": true
        },
        "formations": {
          "type": "array",
          "description": "동선 배열",
          "example": [{"time": 0, "positions": [{"x": 0, "y": 0}]}],
          "required": true
        },
        "distributedFormations": {
          "type": "array",
          "description": "배포 동선 배열",
          "example": [{"time": 0, "positions": [{"x": 0, "y": 0}]}],
          "required": false
        },
        "author": {
          "type": "string",
          "description": "작성자/관리자명",
          "example": "관리자",
          "required": true
        },
        "createdAt": {
          "type": "timestamp",
          "description": "생성 시각",
          "example": "2025-01-01T09:00:00Z",
          "required": true
        },
        "updatedAt": {
          "type": "timestamp",
          "description": "수정 시각",
          "example": "2025-01-01T15:30:00Z",
          "required": true
        },
        "lastActivatedAt": {
          "type": "timestamp",
          "description": "최근 공개/활성화 시각",
          "example": "2025-01-01T16:00:00Z",
          "required": false
        },
        "createdUserId": {
          "type": "string",
          "description": "생성 유저(=User_V2.userId)",
          "example": "user_12345",
          "required": true
        },
        "lastActivatedUserId": {
          "type": "string",
          "description": "최근 활성화 유저(=User_V2.userId)",
          "example": "user_12345",
          "required": false
        }
      },
      "indexes": ["createdAt", "price", "isOfficial", "isCompleted", "isBoyGroup", "headCount"],
      "common_queries": [
        "프리미엄 동선표 총 개수",
        "가격대별 동선표 분포",
        "공식/비공식 동선표 비율",
        "완료된 동선표 수",
        "보이그룹/걸그룹 동선표 분포",
        "인원수별 동선표 분포"
      ]
    },
    "PERFORMANCE_V2": {
      "description": "유저가 생성한(UGC) 동선표의 메타데이터를 담는 컬렉션",
      "document_structure": {
        "documentId": {
          "type": "string",
          "description": "Firestore 문서 ID (=performanceId). 출력 시 별칭 사용",
          "example": "perf_001",
          "required": true
        },
        "title": {
          "type": "string",
          "description": "작품 제목",
          "example": "Butter",
          "required": true
        },
        "artist": {
          "type": "string",
          "description": "아티스트",
          "example": "BTS",
          "required": true
        },
        "headCount": {
          "type": "number",
          "description": "인원수",
          "example": 5,
          "required": true
        },
        "isCompleted": {
          "type": "boolean",
          "description": "제작 완료 여부",
          "example": false,
          "required": true
        },
        "members": {
          "type": "array",
          "description": "멤버 배열",
          "example": [{"name": "Member1", "position": "center"}],
          "required": true
        },
        "formations": {
          "type": "array",
          "description": "동선 배열",
          "example": [{"time": 0, "positions": [{"x": 0, "y": 0}]}],
          "required": true
        },
        "musicId": {
          "type": "number",
          "description": "내부 곡 ID",
          "example": 1002,
          "required": true
        },
        "author": {
          "type": "string",
          "description": "작성자명",
          "example": "댄서123",
          "required": true
        },
        "createdAt": {
          "type": "timestamp",
          "description": "생성 시각",
          "example": "2025-01-01T10:00:00Z",
          "required": true
        },
        "updatedAt": {
          "type": "timestamp",
          "description": "수정 시각",
          "example": "2025-01-01T14:00:00Z",
          "required": true
        },
        "createdUserId": {
          "type": "string",
          "description": "생성 유저(=User_V2.userId)",
          "example": "user_12345",
          "required": true
        }
      },
      "indexes": ["createdAt", "isCompleted", "headCount", "createdUserId"],
      "common_queries": [
        "UGC 동선표 총 개수",
        "완료된/미완료 동선표 비율",
        "사용자별 생성 동선표 수",
        "인원수별 동선표 분포",
        "최근 생성된 동선표"
      ]
    }
  },
  "query_patterns": {
    "time_filters": {
      "today": "createdAt >= today_start",
      "this_week": "createdAt >= week_start",
      "this_month": "createdAt >= month_start",
      "last_7_days": "createdAt >= 7_days_ago"
    },
    "aggregation_examples": {
      "count_users": "get_aggregated_data('User_V2', 'count')",
      "count_premium_performances": "get_aggregated_data('PREMIUM_PERFORMANCE_V2', 'count')",
      "count_ugc_performances": "get_aggregated_data('PERFORMANCE_V2', 'count')",
      "avg_price": "get_aggregated_data('PREMIUM_PERFORMANCE_V2', 'avg', 'price')"
    },
    "common_filters": {
      "active_users": "[{'field': 'lastActiveAt', 'operator': '>=', 'value': '7_days_ago'}]",
      "completed_premium_performances": "[{'field': 'isCompleted', 'operator': '==', 'value': true}]",
      "official_performances": "[{'field': 'isOfficial', 'operator': '==', 'value': true}]",
      "boy_group_performances": "[{'field': 'isBoyGroup', 'operator': '==', 'value': true}]"
    }
  },
  "business_metrics": {
    "user_metrics": [
      "총 사용자 수",
      "신규 가입자 수 (일/주/월)",
      "활성 사용자 수",
      "인증 공급자별 사용자 분포",
      "성별 사용자 분포",
      "동의 상태별 사용자 수"
    ],
    "premium_performance_metrics": [
      "총 프리미엄 동선표 수",
      "완료된 프리미엄 동선표 수",
      "공식/비공식 동선표 비율",
      "가격대별 동선표 분포",
      "보이그룹/걸그룹 동선표 분포",
      "인원수별 동선표 분포"
    ],
    "ugc_performance_metrics": [
      "총 UGC 동선표 수",
      "완료된 UGC 동선표 수",
      "사용자별 생성 동선표 수",
      "인원수별 동선표 분포",
      "최근 생성된 동선표 추이"
    ]
  }
}
